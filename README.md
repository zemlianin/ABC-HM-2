# Инструкция
Exe-файл создается за счет команды линковки четырех файлов
```
gcc ./main.s ./func.s ./get-rand-num-func.s ./itoh.s -o ./solution.exe

```
1. Во время запуска программы пользователю требуется по средствам параметров запуска ввести параметр рандома.
```
./solution.exe 12
```
2. Следующим шагом пользователю требуется ввести длину строки (При использовании тестов записанных в файл, требует указывать размер 80, тк там лежат строки длины 70)
3. Дальнейшее взаимодействие с программой происходит за счет вывода соответствующих сообщений в консоли

[список изменений](https://github.com/zemlianin/ABC-HM-2/blob/master/info/Changes.md)
# Отчет на 4 балла
### Приведено решение задачи на C

1. [main.c](https://github.com/zemlianin/ABC-HM-2/blob/master/main.c)
2. [itoh.c](https://github.com/zemlianin/ABC-HM-2/blob/master/itoh.c)
3. [func.c](https://github.com/zemlianin/ABC-HM-2/blob/master/func.c)
4. [get-rand-num-func.c](https://github.com/zemlianin/ABC-HM-2/blob/master/get-rand-num-func.c)

### Добавлены подробные коментарии в каждый Assebly файл
### Удалены макросы 
Флагами:
```
gcc -masm=intel \
    -fno-asynchronous-unwind-tables \
    -fno-jump-tables \
    -fno-stack-protector \
    -fno-exceptions \
    ./code.c \
    -S -o ./code.s
 ```
 В ручную:
- cdqe
- cdq
- endbr64
### Модифицированная ассемблерная программа отдельно откомпилирована
и скомпонована без использования опций отладки.

### Представлено полное тестовое покрытие, дающее одинаковый результат
Тестирование происходит за счет тестов внутри файла tests.txt, который запускается при выборе нужного режима 0 внутри мэйн

# Отчет на 5 баллов
- Используется функции Task, itoh, Rand, пример:
```
void Task(int *array, int *size, int *B)
void Rand(char *arg, int size, int range, int *A)
char itoh(int a)

```
- Используются локальные переменные i, command, size, input...
- Добавленые коментарии к параметрам функций, примеры:
```
itoh:
mov r13d, edi  # Запсиь n в регистр
```
```
Task:
mov r8, rdi # Запись *array
mov r9, rsi # Запись *size
```
```
main:
mov r14d, edi   # Запись *argc
mov r15, rsi  # Запись *argv

```
- Добавлены коментарии о связи переменных и стека, примеры:
```
lea rdx, -176[rbp]   # Запись адреса массива А в регистр
mov eax, DWORD PTR -4[rbp]  # Запись параметра в регистр
```
```
mov eax, DWORD PTR -180[rbp] # Запись переменной сайз в регистр
cmp DWORD PTR -4[rbp], eax  # Сравнение ее с параметром цикла
```
 
# Отчет на 6 баллов
- Рефакторинг программы на ассемблере за счет максимального использования регистров процессора.

## Main.s:
argc -> r14d

argv -> r15

## func.s:
*array -> r8

*size -> r9

current -> r10d

j -> r11d

code -> r12d

Все переменные отвечающие за работу функции Task были перенесены из стека в регистры

## itoh.s:
i -> r13d

Все переменные отвечающие за работу функции Rand были перенесены из стека в регистры
<br />
- Добавление комментариев, поясняющих эквивалентное использование регистров вместо переменных исходной программы на C.
- Представление результатов тестирования прграммы:

Для сравнения времени работы программ были запущены файлы до оптимизации и после в режиме тестирования, результаты представлены в таблице

<br />

| Номер попытки | До оптимизации, ms  | После оптимизации, ms |
| --- | --- | --- |
| 1 | 69  | 75  |
| 2 | 70  |  77 |
| 3 | 61  | 74  |
| 4 | 76  | 62  |
| 5 | 73  | 38  |
| 6 | 86  | 73  |
| 7 | 96  | 49  |
| 8 | 79  | 45  |
| sum |  610 | 563   |

# Отчет на 7 баллов

- Добавлена функция чтения из файла 
- Добавлена функция вывода в файл
- В файле input содержаться тестовые данные
- В файле output результат работы программы на этих данных

# Отчет на 8 баллов
- В программу добавлен метод Rand, принимающий на вход массив А и заполняющий его случайными числами из требуемого диапозона
- Ввод праметра для генератора при запуске программы
- Добавлена возможность замера времени, вывод происходит в консоль по завершении работы программы, или в случае тестового режима в специально предназначеный файл times.txt

# Отчет на 9 баллов

Для оптимизации кода был задействован флаг -о0
|Параметр|Программа без оптимизации по скорости|Программа с оптимизациями|
|---|---|---|
|Суммарное время работы за 8 запсуков| 603 | 458 |
|Количество строк| 197 | 192 |
|Память|106kb|106kb|
